<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>

<head>
    <title>线路查询显示</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"
          integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
          crossorigin=""/>
    <style type="text/css">
        body {
            padding: 0;
            margin: 0;
        }

        html,
        body,
        #map {
            height: 100%;
        }
    </style>
    <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"
            integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="
            crossorigin=""></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet.chinesetmsproviders@1.0.22/src/leaflet.ChineseTmsProviders.min.js"></script>
</head>

<body>
    <div id='map'></div>
</body>
<%
    String busLineJson = (String)request.getAttribute("busLineJson");
%>
<script type="text/javascript">
	var normalm = L.tileLayer.chinaProvider('GaoDe.Normal.Map', {
	    maxZoom: 18,
	    minZoom: 5
	});
	var imgm = L.tileLayer.chinaProvider('GaoDe.Satellite.Map', {
	    maxZoom: 18,
	    minZoom: 5
	});
	var imga = L.tileLayer.chinaProvider('GaoDe.Satellite.Annotion', {
	    maxZoom: 18,
	    minZoom: 5
	});
	var normal = L.layerGroup([normalm]),
	    image = L.layerGroup([imgm, imga]);
	var baseLayers = {
	    "地图": normal,
	    "影像": image,
	}
	var map = L.map("map", {
	    center: [31.39, 121.26],
	    //center: [31.283503,121.312477],
	    zoom: 12,
	    layers: [normal],
	    zoomControl: false
	});
	L.control.layers(baseLayers, null).addTo(map);
	L.control.zoom({
	    zoomInTitle: '放大',
	    zoomOutTitle: '缩小'
	}).addTo(map);
	L.control.scale().addTo(map);  //比例尺
	L.control.attribution({ position: 'bottomleft', prefix: 'myMap' }).addTo(map); //添加地图名

	map.on('click', showMapPosition);    //点击地图
	map.on('dblclick',addPoint);             //双击地图

	//map.off(....) 关闭该事件

	function showMapPosition(e)
	{
	    alert(e.latlng);
	}

	function addPoint(e)
	{
	    var marker = L.marker([e.latlng.lat, e.latlng.lng]).addTo(map);
	}
    var myLines = [<%=busLineJson%>];
    //var myLines = [{"type": "LineString","coordinates":[[121.32179,31.29672],[121.32157,31.296764],[121.32157,31.296762],[121.321526,31.296623],[121.321495,31.296576],[121.32144,31.296518],[121.32138,31.29646],[121.32128,31.296385],[121.32117,31.29632],[121.32109,31.296276],[121.3209,31.296164],[121.32005,31.295616],[121.31995,31.295565],[121.3192,31.295212],[121.318695,31.29499],[121.31856,31.294931],[121.31728,31.294367],[121.317116,31.294296],[121.31656,31.29405],[121.31657,31.294056],[121.3159,31.293755],[121.31592,31.293732],[121.31573,31.29365],[121.31377,31.292791],[121.31352,31.29323],[121.31274,31.29451],[121.31208,31.295656],[121.312035,31.295734],[121.31186,31.296024],[121.31151,31.296566],[121.31142,31.296722],[121.3114,31.29678],[121.31061,31.29812],[121.31057,31.298164],[121.310165,31.298885],[121.31012,31.29892],[121.31007,31.298893],[121.310036,31.298859],[121.30974,31.298723],[121.30972,31.298746],[121.30972,31.29875],[121.30972,31.298746],[121.30905,31.298447],[121.30714,31.297596],[121.30713,31.29759],[121.30738,31.297178],[121.30738,31.297174],[121.30786,31.296392],[121.30888,31.294735],[121.30906,31.294432],[121.3093,31.29404],[121.309784,31.293259],[121.309944,31.292925],[121.31012,31.292553],[121.31019,31.292414],[121.31028,31.292257],[121.31027,31.292253],[121.3105,31.291822],[121.3108,31.291206],[121.3108,31.291203],[121.31136,31.29168],[121.31153,31.291792],[121.311844,31.291948],[121.31239,31.292206],[121.312904,31.29243],[121.3129,31.292427],[121.31374,31.292795],[121.31419,31.29205],[121.31474,31.291138],[121.31513,31.290455],[121.31525,31.290274],[121.315254,31.290274],[121.315605,31.289675],[121.31563,31.289618],[121.31628,31.290104],[121.31656,31.290318],[121.31708,31.290703],[121.31865,31.291866],[121.31887,31.291655],[121.31913,31.291403],[121.31958,31.290972],[121.31971,31.290833],[121.31991,31.290634],[121.32018,31.290369],[121.320244,31.290304],[121.32076,31.289797],[121.320915,31.289661],[121.32106,31.289545],[121.32165,31.290012],[121.32219,31.29043],[121.32252,31.290668],[121.32287,31.29089],[121.32316,31.291067],[121.323524,31.291246],[121.32377,31.291363],[121.32412,31.29152],[121.32457,31.29102],[121.32507,31.290455],[121.32524,31.290226],[121.326004,31.289328],[121.32622,31.289076],[121.326416,31.288845],[121.325905,31.288502],[121.325485,31.288225],[121.32448,31.287569],[121.324066,31.28731],[121.323586,31.286987],[121.323,31.286592],[121.322556,31.286276],[121.322136,31.286016],[121.3217,31.285746],[121.32128,31.285465],[121.32102,31.285303],[121.32033,31.284857],[121.31951,31.284315],[121.31951,31.28431],[121.31915,31.284067],[121.31901,31.283972],[121.31816,31.28342],[121.31743,31.282942],[121.3158,31.284643],[121.315315,31.285204],[121.31488,31.284925],[121.31487,31.284939],[121.3128,31.283659],[121.31248,31.283503],[121.31239,31.283476],[121.3122,31.28338],[121.311806,31.283152],[121.311806,31.283169],[121.31132,31.282854],[121.31112,31.28271],[121.31099,31.282513],[121.31095,31.282305],[121.31108,31.282131],[121.31131,31.281916],[121.310974,31.28176],[121.310616,31.281881]]}];
    // 	 , {"type": "LineString",
//             "coordinates": [
//                 [-104.8, 39.6],
//                 [-104.9, 39.7],
//                 [-105.0, 39.8]
//             ]
//         }

        var myLayer = L.geoJSON().addTo(map);
        myLayer.addData(myLines);
      //style风格
        var myStyle = {
            "color": "#ff0000",
            "weight": 15,
            "opacity": 0.65
        };

        L.geoJSON(myLines, {
            style: myStyle
        }).addTo(map);

        //L.circle([31.294873, 121.317936],{color:'#D1EEEE',weight:0, fillColor:'#9932CC',radius:450,fillOpacity:0.45}).addTo(map)

</script>

</html>